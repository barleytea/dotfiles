---
description:
globs:
alwaysApply: true
---
# dotfiles.mdc

## Project Overview
This repository is a dotfiles repository for managing macOS and NixOS environment settings. It uses Nix, Home Manager, and nix-darwin for environment setup.

### Supported Architectures
- **Apple Silicon (aarch64-darwin)**: Uses nixpkgs/nix-darwin/home-manager unstable
- **Intel Mac (x86_64-darwin)**: Uses nixpkgs/nix-darwin/home-manager 24.11
- **NixOS (x86_64-linux)**: Uses nixpkgs unstable

## Key Commands

### Nix-related
- `make nix-channel-update`: Update nix-channel
- `make home-manager-apply`: Apply Home Manager settings
- `make nix-darwin-apply`: Apply nix-darwin settings
- `make nix-update-all`: Update all Nix-related settings

### VSCode-related
- `make vscode-apply`: Apply VSCode settings
- `make vscode-insiders-apply`: Apply VSCode Insiders settings
- `make vscode-save`: Save the list of VSCode extensions

### Others
- `make npm-tools`: Install npm-related tools
- `make zsh`: Measure zsh startup time
- `make paths`: Display PATH contents

## Directory Structure
- `home-manager/`: Home Manager configuration files
  - `compat/`: Version-specific packages (unstable.nix, nixpkgs-2411.nix)
- `darwin/`: nix-darwin configuration files
  - `compat/`: Version-specific settings (unstable.nix, nixpkgs-2411.nix)
- `nixos/`: NixOS configuration files
- `vscode/`: VSCode configuration files
- `docs/`: Documentation
- `flake.nix`: Nix Flakes configuration file
- `Makefile`: Task runner configuration file

## Notes
- Apply settings with appropriate commands after making changes
- It is recommended to run `make nix-update-all` especially after changing Nix-related settings
- Version-specific settings are isolated in `compat/` directories to keep modules clean

## Coding Rules

### Nix-related
1. **Package Management**
   - Manage packages primarily in `home.packages` in `home-manager/default.nix`
   - Create functions like `getGolangciLint` to manage packages that require specific versions
   - Fix package versions in `flake.lock`

2. **Modularization**
   - Manage each configuration split into appropriate directories
   - Place common utility functions in the `utils` directory
   - Explicitly declare dependencies between modules using `imports`

3. **Naming Conventions**
   - Use `default.nix` for configuration files
   - Use lowercase with hyphen separators for module names
   - Use camelCase for function names

### Configuration Files
1. **Structuring**
   - Group related settings in the same directory
   - Clarify the hierarchical structure of settings
   - Manage common settings in higher-level `default.nix` files

2. **Comments**
   - Add appropriate comments to complex settings
   - Explain the purpose and reason for settings
   - Clearly describe TODOs and FIXMEs

3. **Version Management**
   - Explicitly specify package versions
   - Update dependencies carefully
   - Record change history appropriately in commit messages

### Others
1. **Security**
   - Do not include sensitive information
   - Use only trusted sources for packages
   - Grant only necessary permissions

2. **Compatibility**
   - Verify operation in macOS environment
   - Support different architectures (Intel/Apple Silicon)
   - Verify compatibility of dependencies

3. **Documentation**
   - Document configuration changes appropriately
   - Maintain troubleshooting information
   - Clearly document setup procedures
